<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>S·ª≠a s√¢n b√≥ng</title>
  <link rel="stylesheet" href="style2.css" />
  <style>
    body {
      margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: url('san bong.jpg') no-repeat center center fixed;
            background-size: cover;
    }
    .container {
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      max-width: 500px;
      margin: 100px auto;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    h2 {
      text-align: center;
      color: #e91e63;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .coords {
      display: flex;
      gap: 10px;
    }
    .coords input {
      flex: 1;
    }
    button {
      margin-top: 20px;
      padding: 12px;
      background-color: #e91e63;
      color: white;
      border: none;
      border-radius: 8px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
    }
    .btn-back {
  display: inline-block;
  margin-top: 15px;
  background-color: #cccccc;
  color: #333;
  text-decoration: none;
  padding: 10px 18px;
  border-radius: 8px;
  font-weight: bold;
  transition: background-color 0.3s ease;
  text-align: center;
}

.btn-back:hover {
  background-color: #b0b0b0;
}

  </style>
</head>
<body>
  <div class="container">
    <h2>üõ†Ô∏è S·ª≠a s√¢n b√≥ng</h2>
    <label for="sanSelect">Ch·ªçn s√¢n b√≥ng:</label>
    <select id="sanSelect">
      <option value="">-- Ch·ªçn --</option>
    </select>

    <label for="trangThai">Tr·∫°ng th√°i s√¢n:</label>
    <input type="text" id="trangThai" placeholder="Nh·∫≠p tr·∫°ng th√°i (v√≠ d·ª•: C√≤n tr·ªëng, ƒê√£ full, B·∫£o tr√¨...)">

    <label for="tenSan">T√™n s√¢n:</label>
    <input type="text" id="tenSan">

    <label for="diaChi">ƒê·ªãa ch·ªâ:</label>
    <input type="text" id="diaChi">

    <label for="hotline">Hotline:</label>
    <input type="text" id="hotline">

    <label for="giaThue">Gi√° thu√™:</label>
    <input type="text" id="giaThue">

    <label>T·ªça ƒë·ªô:</label>
    <div class="coords">
      <input type="text" id="latitude" placeholder="Latitude">
      <input type="text" id="longitude" placeholder="Longitude">
    </div>

    <button onclick="capNhatSan()">C·∫≠p nh·∫≠t s√¢n</button>
    <button onclick="xoaSan()">üóëÔ∏è Xo√° s√¢n</button>
    <a href="home.html" class="btn-back">‚¨ÖÔ∏è Quay l·∫°i trang ch·ªß</a>
  </div>

  <script>
    async function loadDanhSachSan() {
      try {
        const res = await fetch('/api/sanbong');
        const data = await res.json();
        const select = document.getElementById('sanSelect');
        select.innerHTML = '<option value="">-- Ch·ªçn --</option>';
  
        data.forEach(san => {
          const option = document.createElement('option');
          option.value = san.id;
          option.textContent = san.ten_san;
          select.appendChild(option);
        });
      } catch (err) {
        console.error("‚ùå L·ªói khi load danh s√°ch s√¢n:", err);
        alert("Kh√¥ng th·ªÉ t·∫£i danh s√°ch s√¢n!");
      }
    }
  
    document.getElementById('sanSelect').addEventListener('change', async function () {
      const id = this.value;
      if (!id) return;
  
      try {
        const res = await fetch(`/api/sanbong/${id}`);
        const san = await res.json();
  
        document.getElementById('tenSan').value = san.ten_san || '';
        document.getElementById('diaChi').value = san.dia_chi || '';
        document.getElementById('hotline').value = san.hotline || '';
        document.getElementById('giaThue').value = san.gia_thue_s || '';
        document.getElementById('latitude').value = san.latitude || '';
        document.getElementById('longitude').value = san.longitude || '';
      } catch (err) {
        console.error("‚ùå L·ªói khi t·∫£i chi ti·∫øt s√¢n:", err);
        alert("Kh√¥ng th·ªÉ t·∫£i th√¥ng tin s√¢n!");
      }
    });
  
    async function capNhatSan() {
  const id = document.getElementById('sanSelect').value;
  if (!id) {
    alert("Vui l√≤ng ch·ªçn s√¢n c·∫ßn c·∫≠p nh·∫≠t.");
    return;
  }

  const latitudeStr = document.getElementById('latitude').value.trim().replace(',', '.');
  const longitudeStr = document.getElementById('longitude').value.trim().replace(',', '.');

  const latitude = parseFloat(latitudeStr);
  const longitude = parseFloat(longitudeStr);

  if (
    isNaN(latitude) || isNaN(longitude) ||
    latitude < -90 || latitude > 90 ||
    longitude < -180 || longitude > 180
  ) {
    alert("‚ö†Ô∏è T·ªça ƒë·ªô kh√¥ng h·ª£p l·ªá! Latitude ph·∫£i trong [-90, 90], Longitude ph·∫£i trong [-180, 180].");
    return;
  }

  const body = {
    ten_san: document.getElementById('tenSan').value,
    dia_chi: document.getElementById('diaChi').value,
    hotline: document.getElementById('hotline').value,
    gia_thue_s: document.getElementById('giaThue').value,
    latitude: latitude,
    longitude: longitude,
    trang_thai: document.getElementById('trangThai').value
  };

  try {
    const res = await fetch(`/api/sanbong/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });

    if (res.ok) {
      alert("‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!");
    } else {
      alert("‚ùå C·∫≠p nh·∫≠t th·∫•t b·∫°i!");
    }
  } catch (err) {
    console.error("‚ùå L·ªói g·ª≠i c·∫≠p nh·∫≠t:", err);
    alert("Kh√¥ng th·ªÉ g·ª≠i c·∫≠p nh·∫≠t!");
  }
}
  
    async function xoaSan() {
      const id = document.getElementById('sanSelect').value;
      if (!id) {
        alert("Vui l√≤ng ch·ªçn s√¢n c·∫ßn xo√°.");
        return;
      }
  
      const confirmDelete = confirm("‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√° s√¢n n√†y?");
      if (!confirmDelete) return;
  
      try {
        const res = await fetch(`/api/sanbong/${id}`, {
          method: 'DELETE'
        });
  
        if (res.ok) {
          alert("üóëÔ∏è ƒê√£ xo√° s√¢n th√†nh c√¥ng!");
          loadDanhSachSan(); // Reload danh s√°ch thay v√¨ location.reload()
          // Clear form
          document.getElementById('tenSan').value = '';
          document.getElementById('diaChi').value = '';
          document.getElementById('hotline').value = '';
          document.getElementById('giaThue').value = '';
          document.getElementById('latitude').value = '';
          document.getElementById('longitude').value = '';
        } else {
          alert("‚ùå Xo√° s√¢n th·∫•t b·∫°i!");
        }
      } catch (err) {
        console.error("‚ùå L·ªói khi xo√° s√¢n:", err);
        alert("Kh√¥ng th·ªÉ xo√° s√¢n!");
      }
    }
  
    window.addEventListener('DOMContentLoaded', loadDanhSachSan);
  </script>
  
  
</body>
</html>
