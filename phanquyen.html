<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ph√¢n quy·ªÅn ng∆∞·ªùi d√πng</title>
  <link rel="stylesheet" href="style2.css">
</head>
<body class="home-background">
  <div class="home-container">
    <h1>üîê Ph√¢n quy·ªÅn t√†i kho·∫£n</h1>
    <h2>Xin ch√†o, <span id="username"></span>!</h2>

    <div class="form-box">
      <label for="username-input">T√™n ƒëƒÉng nh·∫≠p:</label>
      <input type="text" id="username-input" placeholder="Nh·∫≠p t√™n t√†i kho·∫£n...">

      <label for="role-select">Ch·ªçn quy·ªÅn:</label>
      <select id="role-select">
        <option value="owner">Ch·ªß s√¢n</option>
        <option value="admin">Qu·∫£n tr·ªã vi√™n</option>
      </select>

      <button onclick="assignRole()">C·∫≠p nh·∫≠t quy·ªÅn</button>
      <p id="message"></p>
    </div>

    <button onclick="window.location.href='home.html'" class="feature-btn">üè† V·ªÅ trang ch·ªß</button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const res = await fetch('/api/me');
        if (!res.ok) throw new Error("Kh√¥ng c√≥ quy·ªÅn");

        const data = await res.json();
        const user = data.user;

        if (!user || !user.is_admin) {
          alert("Ch·ªâ qu·∫£n tr·ªã vi√™n m·ªõi ƒë∆∞·ª£c ph√©p truy c·∫≠p.");
          window.location.href = 'home.html';
        } else {
          document.getElementById('username').textContent = user.username;
        }
      } catch (err) {
        alert("Kh√¥ng th·ªÉ x√°c minh quy·ªÅn truy c·∫≠p.");
        window.location.href = 'home.html';
      }
    });

    async function assignRole() {
      const username = document.getElementById('username-input').value;
      const role = document.getElementById('role-select').value;
      const message = document.getElementById('message');

      try {
        const res = await fetch('/api/phanquyen', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, role })
        });

        const data = await res.json();
        if (data.success) {
          message.textContent = '‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!';
        } else {
          message.textContent = '‚ùå ' + data.error;
        }
      } catch (err) {
        message.textContent = '‚ö†Ô∏è L·ªói khi g·ª≠i y√™u c·∫ßu.';
      }
    }
  </script>
</body>
</html>
